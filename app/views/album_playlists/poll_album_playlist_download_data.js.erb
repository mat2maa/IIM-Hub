var $ = jQuery,
    DownloadPoller;

DownloadPoller = {
  poll: function () {
    setTimeout(this.request, 3000);
  },
  request: function () {
    $.ajax({
      url: '/poll_album_playlist_download_data/<%= @album_playlist.id %>',
      type: 'get',
      dataType: 'script'
    });
  }
};

$(".download-info .progress-bar").css({
  width: "<%= "#{@album_playlist.job_current_progress}%" %>"
});

$(".download-info .message").html("<%= j render(partial: 'download_message',
                                                locals: { album_playlist: @album_playlist }) %>");

$(".download-info .download-progress").html("<%= j render(partial: 'download_info_progress',
                                                          locals: { album_playlist: @album_playlist }) %>");

$(".download-info .download-link").html("<%= j render(partial: 'download_link',
                                                      locals: { album_playlist: @album_playlist }) %>");

<% if !@album_playlist.finished? %>
DownloadPoller.poll();
$(".download-info .progress-bar").css({
  width: "0%"
});
<% end %>