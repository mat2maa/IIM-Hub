<% if @movies_count > 0 %>
  <%= form_tag url_for(controller: "movie_playlists",
                       action: "add_multiple_movies"),
               id: "multiple_movies",
               remote: true do %>
    <%= hidden_field_tag 'playlist_id',
                         params[:id] %>
    <%= submit_tag 'Add Selected to Playlist',
                   id: 'add_selected_hidden',
                   style: 'display: none;' %>
    <table class="table" id="no-more-tables">
      <thead>
      <tr>
        <th>
          <%= sort_link @search,
                        :id,
                        "ID",
                        {},
                        {remote: true} %>
        </th>
        <th>
          <%= sort_link @search,
                        :movie_title,
                        "Title",
                        {},
                        {remote: true} %>
        </th>
        <th>
          <%= sort_link @search,
                        :movie_type_name,
                        "Type",
                        {},
                        {remote: true} %>
        </th>
        <th>
          <%= sort_link @search,
                        :airline_release_date,
                        "Release Date",
                        {},
                        {remote: true} %>
        </th>
        <th>Other airlines</th>
        <th></th>
        <th>
          <%= check_box_tag('check_all',
                            'check_all',
                            false) %>
        </th>
      </tr>
      </thead>

      <tbody>
      <% @movies.each do |movie| %>
        <tr class="playlist-entry">
          <%# cache([movie]) do %>
          <td data-title="ID"><%= link_to movie.id,
                          movie_path(id: movie.id),
                          target: "_blank" %>&nbsp;</td>
          <td data-title="Title"><%= movie.movie_title %>&nbsp;</td>
          <td data-title="Type"><%= movie.movie_type.name if movie.movie_type.present? %>&nbsp;</td>
          <td data-title="Release Date"><%= movie.airline_release_date.strftime("%m-%Y") if !movie.airline_release_date
          .nil? %>&nbsp;</td>
          <%# end %>
          <td data-title="Other airlines">
            <span id="exists">
                <% if (movie.in_playlists!="" && !movie.in_playlists.nil?) %>
                    <%= MoviePlaylist.with_same_airline_and_movie(movie.id,
                                                                  (@movie_playlist.airline_id unless @movie_playlist.airline.nil?)).collect { |playlist| link_to("#{playlist.airline.code unless playlist.airline.nil?}#{playlist.start_cycle.strftime("%m%y") unless playlist.start_cycle.nil?}", edit_movie_playlist_path(playlist), target: "_blank") }.join(', ').html_safe %>
                <% end %>
            </span>
            &nbsp;
          </td>
          <td>
            <%= link_to "add to playlist",
                        add_movie_movie_playlist_path(@movie_playlist, movie_id: movie.id),
                        method: :post,
                        remote: true %>
            &nbsp;
          </td>
          <td data-title="Select"><%= check_box_tag "movie_ids[]",
                                                    movie.id %>&nbsp;</td>
        </tr>
      <% end %>
      </tbody>

    </table>
  <% end %>

  <br/>
  <br/>

  <%= will_paginate @movies,
                    inner_window: 1,
                    renderer: BootstrapPagination::Rails,
                    class: 'pagination pagination-small' %>
  <%
     def items_per_page_select(collection = Movies)
       select_tag :per_page, options_for_select([10, 20, 50, 100, 300], collection.per_page),
                  class: 'items_per_page_select_menu'
     end
  %>
  <%= form_for '/movies', method: :get, html: {class: 'items_per_page_select'}, remote: true do |f| %>
    <span>Items per page: </span>
    <%= items_per_page_select @movies %>
    <%= f.submit "Submit",
                 class: 'btn btn-small' %>
    <br>
    <br>
    <%= @movies_count %> movies found
    <br>
  <% end %>
<% else %>
  No movies were found
<% end %>

<script>

  var $ = jQuery;

  $(document).ready(function () {

    $('#check_all').click(function () {
      if (this.checked) {
        $('.playlist-entry').find(':checkbox').each(function () {
          this.checked = true;
        });
      } else {
        $('.playlist-entry').find(':checkbox').each(function () {
          this.checked = false;
        });
      }
    });

  });

</script>